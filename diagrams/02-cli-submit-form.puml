@startuml CLI Submit Form Sequence
!define INFRASTRUCTURE_COLOR #E3F2FD
!define APPLICATION_COLOR #FFF9C4
!define DOMAIN_COLOR #F8BBD0

skinparam backgroundColor white
skinparam sequenceMessageAlign center

title Submit Form via CLI

actor "User" as User
participant "FormCliClient\n(CLI)" as CLI INFRASTRUCTURE_COLOR
participant "HttpClient" as HttpClient INFRASTRUCTURE_COLOR
participant "FormResource\n(REST Controller)" as FormResource INFRASTRUCTURE_COLOR
participant "SubmitFormUseCase" as UseCase APPLICATION_COLOR
participant "Form\n(Domain Entity)" as Form DOMAIN_COLOR
participant "FormRepository" as FormRepo APPLICATION_COLOR
participant "H2FormRepository" as H2Repo INFRASTRUCTURE_COLOR
database "H2 Database\n(forms)" as DB
participant "EventPublisher" as EventPub APPLICATION_COLOR
participant "OutboxEventPublisher" as OutboxPub INFRASTRUCTURE_COLOR
database "H2 Database\n(outbox_events)" as OutboxDB

User -> CLI: ./formcli.sh submit\n--field name=John\n--field email=john@example.com
activate CLI INFRASTRUCTURE_COLOR

CLI -> CLI: parse arguments\nbuild JSON payload

CLI -> HttpClient: POST http://localhost:8080/api/forms\n{name: "John", email: "john@example.com"}
activate HttpClient INFRASTRUCTURE_COLOR

HttpClient -> FormResource: POST /api/forms\n{formData}
activate FormResource INFRASTRUCTURE_COLOR

FormResource -> UseCase: execute(formData)
activate UseCase APPLICATION_COLOR

UseCase -> UseCase: validate formData
UseCase -> Form: new Form(formData)
activate Form DOMAIN_COLOR
Form --> UseCase: form
deactivate Form

UseCase -> FormRepo: save(form)
activate FormRepo APPLICATION_COLOR
FormRepo -> H2Repo: save(form)
activate H2Repo INFRASTRUCTURE_COLOR
H2Repo -> DB: INSERT INTO forms
activate DB
DB --> H2Repo: saved
deactivate DB
H2Repo --> FormRepo: savedForm
deactivate H2Repo
FormRepo --> UseCase: savedForm
deactivate FormRepo

UseCase -> EventPub: publishFormCreated(formId)
activate EventPub APPLICATION_COLOR
EventPub -> OutboxPub: publishFormCreated(formId)
activate OutboxPub INFRASTRUCTURE_COLOR
OutboxPub -> OutboxDB: INSERT INTO outbox_events
activate OutboxDB
OutboxDB --> OutboxPub: saved
deactivate OutboxDB
OutboxPub --> EventPub: void
deactivate OutboxPub
EventPub --> UseCase: void
deactivate EventPub

UseCase --> FormResource: formId
deactivate UseCase

FormResource --> HttpClient: 201 CREATED\n{id, message}
deactivate FormResource

HttpClient --> CLI: HttpResponse(201, body)
deactivate HttpClient

CLI -> CLI: parse response
CLI --> User: âœ“ Form submitted successfully!\nForm ID: {uuid}
deactivate CLI

note right of CLI
  CLI is a standalone Java application
  that acts as an HTTP client
  to interact with the REST API
end note

@enduml
